---
sidebar_position: 1
---

# Java

Java - объектно-ориентированный язык, транслируемый в байт-код, исполняется на виртуальной Java машине.

Виртуальная Java машина (JVM) используется для исполнения байт-кода, написана на языке С и интерпретирует байт-код, 
который получается через javac компилятор (.class)
```bash
javac App.java
```
Классы упаковываются в архивы - .jar

### JIT (Just in time) компиляция
Во время выполнения программа может быть скомпилирована в машинный код для повышения ее производительности - 
это означает, что полученный машинный код оптимизирован для архитектуры процессора конкретного компьютера.
Java начинает оптимизацию после определенного количества проходов по куску кода. 
Могут отбрасываться косвенные вызовы (вызовы делаются напрямую через inline подстановки функций) и пр.

### ООП
ООП - это парадигма программирования на основе объектов. Основана на принципах инкапсуляции, наследования и полиморфизма.  

Процедурное программирование не подходит, когда есть богатая предметная область, много различных сущностей.

Объект - сущность у которой есть состояние, поведение, уникальность, занимает какое-то место в памяти.
#### Абстрагирование
>Идеальная модель - это модель из которой больше нечего убрать.

В объектах нужно выделить существенные и несущественные детали. Из ТЗ выбрать какие-то принципиальные/основные объекты, на основе которых будет строиться программа.
#### Инкапсуляция
Свойство системы, позволяющее объединить данные и методы, работающие с ними. Сокрытие реализации.
#### Наследование
Отношение между классами, наследник использует структуру или поведение другого классами. Используем только если удовлетворяется is-a.
#### Полиморфизм
Способность системы универсально общаться с объектами имеющими общего предка, не зная об ее внутреннем устройстве.  Позволяет использовать различные имплементации без изменения кода.   

Override (Переопределение) — полиморфизм во время выполнения (runtime), основанный на самом объекте.   
Overload (Перегрузка) — полиморфизм во время компиляции (compile), основанный на типе.   
#### Отношения между классами
- Агрегация - содержит. Аквариум содержит рыбки.
- Композиция - более жесткая связь чем агрегация, при удалении объекта удаляются его составные части: Квартира - комната.
- Ассоциация - нет жестких связей, ссылаются друг на друга.
- Мета-классы - описание этого объекта.
#### Недостатки ООП
- Наследуемый класс не может контролировать изменения в родительском классе, например если там что-то переопределилось.
- У нас есть квадрат и прямоугольник, как лучше сделать наследование? Что случится, если будут методы задать ширину и высоту?
- При полиморфизме могут быть не прямые, а косвенные вызовы, позднее связывание. Компенсируется JIT.

### Основные области памяти в JVM
На самом нижнем уровне процессор оперирует регистрами - AX, BX. Всего 8 штук.
#### Стек (Stack)
Стек работает по схеме LIFO (последним вошел, первым вышел). Всякий раз, когда вызывается новый метод, содержащий примитивные значения или ссылки на объекты, 
то на вершине стека под них выделяется блок памяти. Из этого можно сделать вывод, что стек хранит значения примитивных переменных, 
создаваемых в методах, а также ссылки на объекты в куче на которые ссылается метод.
- Он заполняется и освобождается по мере вызова и завершения новых методов
- Переменные в стеке существуют до тех пор, пока выполняется метод в котором они были созданы
- Если память стека будет заполнена, Java бросит исключение java.lang.StackOverFlowError
- Доступ к этой области памяти осуществляется быстрее, чем к куче
- Является потокобезопасным, поскольку для каждого потока создается свой отдельный стек

```text
-Xss256k
```
Хранит:
- Локальные переменные
- Аргументы методов (адреса объектов)
- Адреса возврата из методов, функций

Каким образом в Java передаются параметры:
- Примитивные типы по значению 
- Сложные по ссылкам, по значению их адреса

На железе в кеше процессора L1 L2
#### Куча (Heap)
Эта область памяти используется для динамического выделения памяти для объектов и классов JRE во время выполнения. 
Новые объекты всегда создаются в куче, а ссылки на них хранятся в стеке.   
Эти объекты имеют глобальный доступ и могут быть получены из любого места программы.   

Эта область памяти разбита на несколько более мелких частей, называемых поколениями:
- Young Generation — область где размещаются недавно созданные объекты. Когда она заполняется, происходит быстрая сборка мусора
- Old (Tenured) Generation — здесь хранятся долгоживущие объекты. Когда объекты из Young Generation достигают определенного порога «возраста», 
они перемещаются в Old Generation

Ключевые особенности:
- Когда эта область памяти полностью заполняется, Java бросает java.lang.OutOfMemoryError
- Доступ к ней медленнее, чем к стеку
- Эта память, в отличие от стека, автоматически не освобождается. Для сбора неиспользуемых объектов используется сборщик мусора
- В отличие от стека, куча не является потокобезопасной и ее необходимо контролировать, правильно синхронизируя код

```text
-Xms256m - минимальные размер
-Xmx512m - максимальный размер
-XX:NewRatio=2  # соотношение eden + survivor/survivor
```

#### Metaspace 
Хранение мета данных при загрузке класса, объектов типа класс. Стринговые константы (String Literal Pool).
